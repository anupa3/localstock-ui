<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Find Nearby Stores</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 820px; margin: 28px auto; padding: 0 16px; }
    h1 { font-size: 1.6rem; margin: 0 0 10px; }
    .muted { color: #666; font-size: 0.95rem; }
    .panel { border: 1px solid #ddd; border-radius: 14px; padding: 14px; margin: 12px 0; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    input { flex: 1; min-width: 260px; padding: 10px 12px; border: 1px solid #ccc; border-radius: 10px; }
    button { padding: 10px 12px; border: 1px solid #ccc; border-radius: 10px; cursor: pointer; background: #f7f7f7; }
    button:hover { background: #eee; }
    .pill { display: inline-block; padding: 4px 10px; border-radius: 999px; border: 1px solid #ddd; font-size: 0.85rem; }
    .cards { margin-top: 10px; }
    .card { border: 1px solid #e2e2e2; border-radius: 14px; padding: 12px; margin: 10px 0; }
    .card-title { display: flex; justify-content: space-between; gap: 10px; align-items: baseline; }
    .store-name { font-weight: 700; }
    .dist { font-variant-numeric: tabular-nums; }
    .actions { margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap; }
    .small { font-size: 0.9rem; }
  </style>
</head>
<body>

  <h1>Find the 10 closest stores</h1>
  <div class="muted">Try zip codes: <b>11367</b>, <b>10001</b>, <b>11201</b>, <b>10451</b></div>

  <div class="panel">
    <div class="row">
      <input id="zip" placeholder="Enter zip code (e.g., 11367)" />
      <button id="zipBtn">Search by Zip</button>
      <button id="gpsBtn">Use My Location</button>
      <span class="pill" id="status">Idle</span>
    </div>
  </div>

  <div class="panel">
    <div class="row" style="justify-content: space-between;">
      <div>
        <b>Results</b>
        <div class="muted small">Sorted by distance (miles). Showing up to 10 stores.</div>
      </div>
      <button id="clearBtn">Clear</button>
    </div>
    <div class="cards" id="results"></div>
  </div>

<script>
/* ------------------ Dummy Zip → Lat/Lon ------------------ */
const zipToLatLon = {
  "11367": { lat: 40.7365, lon: -73.8196 }, // Queens College area
  "10001": { lat: 40.7506, lon: -73.9972 }, // Manhattan
  "11201": { lat: 40.6958, lon: -73.9952 }, // Brooklyn Heights
  "10451": { lat: 40.8199, lon: -73.9227 }  // Bronx
};

/* ------------------ Dummy Stores (replace later with DB/API) ------------------ */
const stores = [
  { id: 1,  name: "Queens Mini Mart",     lat: 40.7349, lon: -73.8150, address: "Main St, Queens, NY" },
  { id: 2,  name: "Fresh Corner Grocery", lat: 40.7412, lon: -73.8209, address: "Kissena Blvd, Queens, NY" },
  { id: 3,  name: "Astoria Market",       lat: 40.7644, lon: -73.9235, address: "30th Ave, Queens, NY" },
  { id: 4,  name: "LIC Pharmacy",         lat: 40.7447, lon: -73.9488, address: "Jackson Ave, Queens, NY" },
  { id: 5,  name: "Manhattan QuickStop",  lat: 40.7510, lon: -73.9900, address: "8th Ave, New York, NY" },
  { id: 6,  name: "SoHo Convenience",     lat: 40.7240, lon: -74.0000, address: "Prince St, New York, NY" },
  { id: 7,  name: "Brooklyn General",     lat: 40.6932, lon: -73.9890, address: "Court St, Brooklyn, NY" },
  { id: 8,  name: "DUMBO Pantry",         lat: 40.7033, lon: -73.9896, address: "Water St, Brooklyn, NY" },
  { id: 9,  name: "Bronx Essentials",     lat: 40.8205, lon: -73.9130, address: "Grand Concourse, Bronx, NY" },
  { id: 10, name: "Harlem Food Hub",      lat: 40.8116, lon: -73.9465, address: "Lenox Ave, New York, NY" },
  { id: 11, name: "Flushing Supplies",    lat: 40.7590, lon: -73.8300, address: "Roosevelt Ave, Queens, NY" },
  { id: 12, name: "Jamaica Value Store",  lat: 40.7027, lon: -73.7890, address: "Jamaica Ave, Queens, NY" },
];

/* ------------------ Distance (Haversine) ------------------ */
function haversineMiles(lat1, lon1, lat2, lon2) {
  const R = 3958.8; // Earth radius in miles
  const toRad = d => d * Math.PI / 180;

  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);

  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
    Math.sin(dLon / 2) ** 2;

  return 2 * R * Math.asin(Math.sqrt(a));
}

/* ------------------ UI Helpers ------------------ */
const statusEl = document.getElementById("status");
const resultsEl = document.getElementById("results");
const zipEl = document.getElementById("zip");

function setStatus(text) {
  statusEl.textContent = text;
}

function clearResults() {
  resultsEl.innerHTML = "";
  setStatus("Idle");
  zipEl.value = "";
}

function renderStores(centerLat, centerLon, label) {
  setStatus(label);

  const ranked = stores
    .map(s => ({
      ...s,
      dist: haversineMiles(centerLat, centerLon, s.lat, s.lon)
    }))
    .sort((a, b) => a.dist - b.dist)
    .slice(0, 10);

  if (ranked.length === 0) {
    resultsEl.innerHTML = `<div class="muted">No stores found.</div>`;
    return;
  }

  resultsEl.innerHTML = ranked.map(s => `
    <div class="card">
      <div class="card-title">
        <div class="store-name">${s.name}</div>
        <div class="dist">${s.dist.toFixed(2)} mi</div>
      </div>
      <div class="muted">${s.address}</div>
      <div class="actions">
        <button onclick="alert('Open store page for ID ${s.id} (dummy)')">View store</button>
        <button onclick="alert('Directions to ${s.name} (dummy)')">Directions</button>
      </div>
    </div>
  `).join("");
}

/* ------------------ Actions ------------------ */
function searchByZip() {
  const zip = zipEl.value.trim();
  const loc = zipToLatLon[zip];

  if (!loc) {
    setStatus("Unknown zip. Try 11367, 10001, 11201, 10451.");
    resultsEl.innerHTML = "";
    return;
  }

  renderStores(loc.lat, loc.lon, `Using zip ${zip}`);
}

function useMyLocation() {
  if (!navigator.geolocation) {
    setStatus("Geolocation not supported. Use zip instead.");
    return;
  }

  setStatus("Getting your location…");
  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      renderStores(lat, lon, `Using GPS (${lat.toFixed(4)}, ${lon.toFixed(4)})`);
    },
    err => {
      setStatus("Location blocked. Use zip instead.");
    },
    { enableHighAccuracy: true, timeout: 8000 }
  );
}

/* ------------------ Wire Buttons ------------------ */
document.getElementById("zipBtn").addEventListener("click", searchByZip);
document.getElementById("gpsBtn").addEventListener("click", useMyLocation);
document.getElementById("clearBtn").addEventListener("click", clearResults);

// Optional: press Enter in the zip box
zipEl.addEventListener("keydown", (e) => {
  if (e.key === "Enter") searchByZip();
});
</script>

</body>
</html>
